# Hello, world!
#
# This is an example function named 'hello'
# which prints 'Hello, world!'.
#
# You can learn more about package authoring with RStudio at:
#
#   http://r-pkgs.had.co.nz/
#
# Some useful keyboard shortcuts for package authoring:
#
#   Build and Reload Package:  'Cmd + Shift + B'
#   Check Package:             'Cmd + Shift + E'
#   Test Package:              'Cmd + Shift + T'

#Libraries needed
library("ipred")
library("rpart")
library("mlbench")

#MAIN FUNCTIONS
#The Class of MET-DES
METDES <- setClass("metades", slots=list(
  pool_classifiers = "ANY",
  meta_classifiers = "ANY",
  Hc = "numeric"
))

init <- function(pool_classifiers=NaN, meta_classifiers=NaN, Hc=.5) {
  #initialization of the METDES class
  METDES()
  library("ipred")
  library("rpart")
  library("mlbench")

  d <<- new("metades", pool_classifiers=pool_classifiers,
            meta_classifiers = meta_classifiers,
            Hc = Hc)
}

#Example data for testing
data(BreastCancer)
BreastCancer$Id <- NULL

learn <- BreastCancer[1:20,]
learn$Id <- NULL
test <- BreastCancer[21:40, 1:10]
test$Id <- NULL

fit <- function(data) {
  overproduction(data)
  #metatraining()
  #generalization()
}

overproduction <- function(data) {
  d@pool_classifiers <<- bagging(Class ~., data = data, coob = T)
}

metatraining <- function() {
  c <- d@pool_classifiers
}

generalization <- function() {

}

#Testing function
get_tree_n <- function(n){
  #returns the n regression tree from the pool of classificators
  #the pool of classificators is stored in variable "d"
  #TO-DO if clause
  return(d@pool_classifiers$mtrees[[n]]$btree)
}

#TO-DO take it to another file
#Testing Bagging package
data(BreastCancer)
BreastCancer$Id <- NULL
res <- bagging(Class ~ Cl.thickness + Cell.size
               + Cell.shape + Marg.adhesion
               + Epith.c.size + Bare.nuclei
               + Bl.cromatin + Normal.nucleoli
               + Mitoses, data=BreastCancer, coob=TRUE)

DataSample <- BreastCancer[1:20,]
test <- BreastCancer[1:20, 1:10]
test$Id <- NULL

DataSample$Id <- NULL
mt <- bagging(Class ~ ., DataSample, coob = T)


f1 <- mt$mtrees[[1]]$btree
plot(f1)
text(f1, use.n=F)

par(mfrow = c(1,2), xpd = NA)
f2 <- mt$mtrees[[19]]$btree
plot(f2)
text(f2, use.n=F)

predict(f2, test)
